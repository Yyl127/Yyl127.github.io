<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="exe11.css">
    <script src="js/jquery-3.2.1.min.js"></script>
    <script>
        let time;
        let letter;
        //定义vip账户
        let vips = ['hy'];
        //定义黑名单
        let blacks = ['rose'];
        let username;

        $(function() {
            //点击开始按钮
            $('a[start]').click(() => {

                username = prompt('请输入账号');

                //将开始时间和成绩重置
                $('#lastTime_sec').html('10');
                $('#score').html(0);

                //倒计时
                start();


                //生成键盘数字
                generateLetter();

                //开始键盘监听，监听keyup事件
                start_listen_keyboard();

            });

            //点击"充值"按钮
            $('a[vip]').click(() => {
                //alert(1);
                let money = prompt('请输入充值金额');
                let name = prompt('请输入充值账户');
                if (money > 10000) {
                    vips.push(name);

                }
                //console.log(vips);
            });


        });




        let start_listen_keyboard = () => {
            $(document).keyup(function(evt) {
                evt = window.event || evt;
                let user_char = evt.key;
                //console.log(user_char);
                //三种情况可以加分，1.正确输字，2.vip账号3.并且不是黑名单账号
                if ((user_char == letter || $.inArray(username, vips) != -1) && $.inArray(username, blacks) == -1) {
                    //如果按键值与输入值相同，重新产生一个新的字符，加10分
                    generateLetter();
                    $('#score').html($('#score').html() - 0 + 10);
                    return;
                }
                //如果不一样，扣5分
                $('#score').html($('#score').html() - 5);


            });
        }

        function start() {
            //alert(1);		
            let $s = $('#lastTime_sec');
            if (time) {
                return;
            }
            time = setInterval(() => {
                let sec = ($s.html() - 0.01).toFixed(2);
                //将该时间写到节点上
                $s.html(sec);
                if (sec <= 0) {
                    //如果时间小于0，停止计时，解除绑定事件
                    clearTimeout(time);
                    $(document).unbind('keyup');
                    time = false;
                }

            }, 10);

        }

        //生成字符
        let generateLetter = () => {
            //将键盘颜色全部改为默认色，隐藏
            $('.keyboard span').css('color', '#bd822a');
            //获取a-z中的任何一个字符
            //97-122--->a-z
            letter = String.fromCharCode(parseInt(Math.random() * 26 + 97));
            $('.letter span').html(letter);
            //在键盘上显示对应字符
            $(`.keyboard span:contains(${letter})`).css('color', 'white');




        }
    </script>
</head>

<body>

    <div class="container">

        <div class="msg">

            <p>
                <span>剩余时间：
					<span id="lastTime_sec">10</span> s
                </span>
                <span class="fr">成绩 <span id="score">0</span> </span>
            </p>

        </div>

        <div class="section">
            <div class="letter">
                <span>?</span>
            </div>
        </div>

        <div class="keyboard">


            <div>
                <span class="a">q</span>
                <span>w</span>
                <span>e</span>
                <span>r</span>
                <span>t</span>
                <span>y</span>
                <span>u</span>
                <span>i</span>
                <span>o</span>
                <span>p</span>
            </div>
            <div>
                <span>a</span>
                <span>s</span>
                <span>d</span>
                <span>f</span>
                <span>g</span>
                <span>h</span>
                <span>j</span>
                <span>k</span>
                <span>l</span>
            </div>
            <div>
                <span>z</span>
                <span>x</span>
                <span>c</span>
                <span>v</span>
                <span>b</span>
                <span>n</span>
                <span>m</span>
            </div>

        </div>


        <div class="op">

            <a href="#" start>开始</a>

            <a href="#" vip>充值</a>

        </div>


    </div>

</body>

</html>
